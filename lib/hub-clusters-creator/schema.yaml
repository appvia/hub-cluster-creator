---
type: object
title: GKE Cluster Configuration
required:
  - description
  - domain
  - name

properties:
  authorized_master_cidrs:
    $id: '#/properties/authorized_master_cidrs'
    tags: ['default']
    provider: ['*']
    type: array
    title: Master Authorized Networks
    items:
      $id: '#/properties/authorized_master_cidrs/items'
      type: object
      title: Networks
      required:
        - name
        - cidr
      properties:
        name:
          $id: '#/properties/authorized_master_cidrs/items/properties/name'
          type: string
          title: Display Name
          default: 'allowany'
          examples:
            - any
          pattern: ^(.*)$
        cidr:
          $id: '#/properties/authorized_master_cidrs/items/properties/cidr'
          type: string
          title: Network CIDR
          default: '0.0.0.0/0'
          examples:
            - 0.0.0.0/0
          pattern: ^([\d]{1,3}\.){3}[\d]{1,3}\/[\d]{1,2}$

  cluster_ipv4_cidr:
    $id: '#/properties/cluster_ipv4_cidr'
    tags: ['advanced']
    provider: ['gcp']
    type: string
    title: Cluster Pod Network
    default: ''
    description: >
      An optional network CIDR which is used to place the pod network on
      (else the cloud provider chooses)
    examples:
      - ''
    pattern: ^(([\d]{1,3}\.){3}[\d]{1,3}\/[\d]{1,2}|)$

  create_subnetwork:
    $id: '#/properties/create_subnetwork'
    tags: ['advanced']
    provider: ['gcp']
    type: boolean
    title: Create Subnetwork
    description: >
      Indicates if you wish to create a new subnetwork to place the
      compute node on to.
    default: false
    examples:
      - false
      - true

  domain:
    $id: '#/properties/domain'
    tags: ['default']
    provider: ['*']
    type: string
    title: Cloud DNS Domains
    default: ''
    description: >
      The dns domain which the cluster is using; this mist be accessible from
      with inside the project.
    examples:
      - 'example.com'

  disk_size_gb:
    $id: '#/properties/disk_size_gb'
    tags: ['default']
    provider: ['*']
    type: integer
    title: Compute Disk Size (GB)
    default: 100
    description: >
      Is the size of the disk used by the compute nodes
      The dns domain which the cluster is using; this mist be accessible from
      with inside the project.
    examples:
      - 100

  enable_autorepair:
    $id: '#/properties/enable_autorepair'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: Node Autorepair
    default: true
    description: >
      Indicates if the cluster should be configured with auto repair
      is enabled
    examples:
      - false
      - true

  enable_autoscaler:
    $id: '#/properties/enable_autoscaler'
    tags: ['default']
    provider: ['*']
    type: boolean
    title: Cluster Autoscaling
    default: true
    description: >
      Indicates if the cluster should be configured with cluster autoscaling
      turned on
    examples:
      - false
      - true

  enable_autoupgrade:
    $id: '#/properties/enable_autoupgrade'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: Cluster Autoupgrading
    default: true
    description: >
      Indicates if the cluster should be configured with autograding
      enabled; meaning both nodes are masters are autoscated scheduled
      to upgrade during your maintenance window.
    examples:
      - false
      - true

  enable_binary_authorization:
    $id: '#/properties/enable_binary_authorization'
    tags: ['advanced']
    provider: ['gcp']
    type: boolean
    title: Binary Authorization Service
    default: false
    description: >
      Indicates if the cluster should be configured with GKE Binary
      Authorization service enabled.
    examples:
      - false
      - true

  enable_horizontal_pod_autoscaler:
    $id: '#/properties/enable_horizontal_pod_autoscaler'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: Horizontal Pod Autoscaler
    default: false
    description: >
      Indicates if the cluster is configured with the horizontal
      pod autoscaler addon. This automatically adjusts the cpu and
      memory resources of pods in accordances with their demand. You
      should ensure you use PodDisruptionBudgets if this is enabled.
    examples:
      - false
      - true

  enable_http_loadbalancer:
    $id: '#/properties/enable_http_loadbalancer'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: HTTP Ingress Controller
    default: true
    description: >
      Indicates if the cluster should be configured with the GKE
      ingress controller. When enabled GKE will autodiscover your
      ingress resources and provision load balancer on your behalf.
    examples:
      - false
      - true

  enable_istio:
    $id: '#/properties/enable_istio'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: Istion Service Mesh
    default: false
    description: >
      Indicates if the GKE Istio service mesh is deployed to the
      cluster; this provides a more feature rich routing and
      instrumentation.
    examples:
      - false
      - true

  enable_logging:
    $id: '#/properties/enable_logging'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: Stackdriver Logging
    default: true
    description: >
      Indicates if Stackdriver metrics should be enabled for the cluster
    examples:
      - false
      - true

  enable_monitoring:
    $id: '#/properties/enable_monitoring'
    tags: ['default']
    provider: ['gcp']
    type: boolean
    title: Stackdriver Metrics
    default: true
    description: >
      Indicates if Stackdriver logging should be enabled for the cluster
    examples:
      - false
      - true

  enable_network_policies:
    $id: '#/properties/enable_network_policies'
    tags: ['advanced']
    provider: ['*']
    type: boolean
    title: Network Policies Enforcement
    default: true
    description: >
      Indicates if network policies via Calico is enabled in the cluster
    examples:
      - true
      - false

  enable_pod_security_policies:
    $id: '#/properties/enable_pod_security_polices'
    tags: ['advanced']
    provider: ['*']
    type: boolean
    title: Pod Security Policies
    default: true
    description: >
      Indicates is pod security policies should be enabled in the cluster.
    examples:
      - true
      - false

  enable_private_endpoint:
    $id: '#/properties/enable_private_endpoint'
    tags: ['advanced']
    provider: ['gcp']
    type: boolean
    title: Private Endpoints
    default: false
    description: >
      Indicates if the master api endpoint should be accessible from private
      network only i.e. no external access
    examples:
      - false
      - true

  enable_private_network:
    $id: '#/properties/enable_private_network'
    tags: ['advanced']
    provider: ['gcp']
    type: boolean
    title: Private Node Networking
    default: true
    description: >
      Indicates if compute nodes should have external ip addresses or use
      private networking and a cloud-nat device.
    examples:
      - false
      - true

  image_type:
    $id: '#/properties/image_type'
    tags: ['advanced']
    provider: ['gcp']
    type: string
    title: Machine Image
    default: 'COS'
    description: >
      The operating system image the compute pool should use.
    examples:
      - COS
    pattern: ^(.*)$

  github_client_id:
    $id: '#/properties/github_client_id'
    tags: ['default']
    provider: ['*']
    type: string
    title: Github Client ID
    default: ''
    description: >
      The Github client id for the oauth2 application
    examples:
      - ''
    pattern: ^(.*)$

  github_client_secret:
    $id: '#/properties/github_client_secret'
    tags: ['default']
    provider: ['*']
    type: string
    title: Github Client Secret
    default: ''
    description: >
      The Github client secret taken from the oauth2 application
    examples:
      - ''
    pattern: ^(.*)$

  grafana_disk_size:
    $id: '#/properties/grafana_disk_size'
    type: integer
    provider: ['*']
    title: Grafana Disk Size
    default: 10
    description: >
      The size of the disk used for grafana instance
    examples:
      - 10
      - 100

  grafana_hostname:
    $id: '#/properties/grafana_hostname'
    tags: ['default']
    provider: ['*']
    type: string
    title: Grafana Hostname
    default: 'grafana'
    description: >
      The dns hostname which grafana should be configured to respond to.
    examples:
      - grafana
      - metrics
    pattern: ^(.*)$

  grafana_version:
    $id: '#/properties/grafana_version'
    tags: ['advanced']
    provider: ['*']
    type: string
    title: Grafana Version
    default: '6.2.5'
    description: >
      The version of the grafana which should be installed.
    examples:
      - 6.2.5
    pattern: ^(.*)$

  machine_type:
    $id: '#/properties/machine_type'
    tags: ['default']
    provider: ['*']
    type: string
    title: Machine Type
    description: >
      The GCP machine type which the default nodes pool should use.
    examples:
      - n1-standard-1
    pattern: ^(.*)$

  maintenance_window:
    $id: '#/properties/maintenance_window'
    tags: ['default']
    provider: ['gcp']
    type: string
    title: Maintenance Window
    default: '03:00'
    description: >
      Specifies the maintenance window in hours and minutes which GKE
      is permitted to run maintenance operations.
    examples:
      - '03:00'
    pattern: ^[\d]{2}:[\d]{2}$

  master_ipv4_cidr_block:
    $id: '#/properties/master_ipv4_cidr_block'
    tags: ['default']
    provider: ['gcp']
    type: string
    title: Master Peer Network Block
    default: '172.16.0.0/28'
    description: >
      If private networking is enabled, this is the peering subnet used
      to to GKE master api layer. Note, this must be unique within the
      network.
    examples:
      - '172.16.0.0/28'
    pattern: ^([\d]{1,3}\.){3}[\d]{1,3}\/[\d]{1,2}$

  max_nodes:
    $id: '#/properties/max_nodes'
    tags: ['default']
    provider: ['*']
    type: integer
    title: Max Nodes
    default: 10
    description: >
      Assuming the autoscaler is enabled this is the maximum number
      nodes permitted.
    examples:
      - 10

  network:
    $id: '#/properties/network'
    tags: ['default']
    provider: ['gcp']
    type: string
    title: GCP Network
    default: 'default'
    description: >
      The GCP network which the cluster should reside on, which have
      to be unique within the GCP project and created beforehand.
    examples:
      - 'default'
    pattern: ^(.*)$

  preemptible:
    $id: '#/properties/preemptible'
    tags: ['advanced']
    provider: ['gcp']
    type: boolean
    title: Preemptible Nodes
    default: false
    description: >
      Indicates if the default pool created should use preemptible nodes.
    examples:
      - false
      - true

  region:
    $id: '#/properties/region'
    tags: ['default']
    provider: ['*']
    type: string
    title: GCP Region
    default: 'europe-west2'
    description: >
      The GCP region which the cluster will reside within (europe-west2 etc)
    examples:
      - europe-west2
    pattern: ^(.*)$

  services_ipv4_cidr:
    $id: '#/properties/services_ipv4_cidr'
    tags: ['advanced']
    provider: ['*']
    type: string
    title: Cluster Services CIDR
    default: ''
    description: >
      An optional network cidr configured for the cluster services,
      otherwise GCP will decide.
    examples:
      - ''
    pattern: ^(([\d]{1,3}\.){3}[\d]{1,3}\/[\d]{1,2}|)$

  size:
    $id: '#/properties/size'
    tags: ['default']
    provider: ['*']
    type: integer
    title: Initial Node Size
    default: 1
    description: >
      The number of nodes per zone which should exist in the cluster.
    examples:
      - 1
      - 10

  ssh_key:
    $id: '#/properties/ssh_key'
    tags: ['default']
    provider: ['aks']
    type: string
    title: SSH Public Key
    default: ''
    description: >
      A public ssh key used provision the compute nodes with
    examples:
      - ssh-rsa
    pattern: ^ssh-rsa.*$

  subnetwork:
    $id: '#/properties/subnetwork'
    tags: ['default']
    provider: ['gcp']
    type: string
    title: Subnetwork for Nodes
    default: 'default'
    description: >
      The name of the GCP subnetwork which the cluster nodes should reside.
    examples:
      - default
    pattern: ^(.*)$

  version:
    $id: '#/properties/version'
    tags: ['default']
    provider: ['*']
    type: string
    title: Initial Kubernetes Version
    default: 'latest'
    description: >
      The initial kubernetes version which the cluster should be
      configured with.
    examples:
      - latest
      - 1.13.7-gke.8
    pattern: ^(.*)$
